<!-- src/app/features/config/pages/config-home/config-home.html -->
<div class="config-page">
  <h2>‚öôÔ∏è Configuraci√≥n</h2>

  <!-- ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ -->
  <div class="tabs">
    <button class="tab-btn" [class.active]="activeTab==='products'" (click)="activeTab='products'">
      üóÇÔ∏è Productos
    </button>
    <button class="tab-btn" [class.active]="activeTab==='users'" (click)="activeTab='users'">
      üë• Usuarios
    </button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB PRODUCTOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" *ngIf="activeTab==='products'">

    <!-- Formulario -->
    <div class="card">
      <p class="card-title">
        {{ pForm().id ? '‚úèÔ∏è Editar producto' : '‚ûï Nuevo producto' }}
      </p>

      <div class="product-form">

        <!-- Fila 1: Nombre (ancho completo) -->
        <div class="form-row full">
          <div class="field">
            <label>Nombre *</label>
            <input type="text" placeholder="Ej. Capuchino"
              [ngModel]="pForm().nombre" (ngModelChange)="setPNombre($event)" />
          </div>
        </div>

        <!-- Fila 2: C√≥digo SKU + Precio -->
        <div class="form-row">
          <div class="field">
            <label>C√≥digo SKU *</label>
            <input type="text" placeholder="Ej. CAF001"
              [ngModel]="pForm().codigo" (ngModelChange)="setPCodigo($event)" />
          </div>
          <div class="field">
            <label>Precio ($)</label>
            <input type="number" min="0" step="0.01" placeholder="0.00"
              [ngModel]="pForm().precio" (ngModelChange)="setPPrecio($event)" />
          </div>
        </div>

        <!-- Fila 3: Categor√≠a + Stock -->
        <div class="form-row">
          <div class="field">
            <label>Categor√≠a</label>
            <select [ngModel]="pForm().categoria" (ngModelChange)="setPCategoria($event)">
              <option *ngFor="let c of categorias" [value]="c">
                {{ getCategoryIcon(c) }} {{ c }}
              </option>
            </select>
          </div>
          <div class="field">
            <label>Stock</label>
            <input type="number" min="0" placeholder="0"
              [ngModel]="pForm().stock" (ngModelChange)="setPStock($event)" />
          </div>
        </div>

        <!-- Fila 4: IVA + Estado -->
        <div class="form-row">
          <div class="field">
            <label>IVA (ej: 0.16)</label>
            <input type="number" min="0" max="1" step="0.01" placeholder="0.16"
              [ngModel]="pForm().taxRate" (ngModelChange)="setPTax($event)" />
          </div>
          <div class="field">
            <label>Estado</label>
            <select [ngModel]="pForm().activo" (ngModelChange)="setPActivo($event === 'true' || $event === true)">
              <option [value]="true">‚úÖ Activo</option>
              <option [value]="false">‚õî Inactivo</option>
            </select>
          </div>
        </div>

        <!-- Fila 5: Foto (ancho completo) -->
        <div class="form-row full">
          <div class="field">
            <label>Foto del producto</label>
            <input type="file" accept="image/*"
              (change)="onPickImage($any($event.target).files[0] ?? null)" />
          </div>
        </div>

        <!-- Error -->
        <p class="error-msg" *ngIf="pError()">{{ pError() }}</p>

        <!-- Acciones -->
        <div class="form-actions">
          <button class="btn btn-outline" (click)="clearProductForm()">Limpiar</button>
          <button class="btn btn-primary" [disabled]="pLoading()" (click)="saveProduct()">
            {{ pLoading() ? 'Guardando‚Ä¶' : pForm().id ? 'Actualizar' : 'Crear producto' }}
          </button>
        </div>

      </div>
    </div>

    <!-- Tabla de productos -->
    <div class="card table-card">
      <div class="table-header">
        <span class="table-title">Productos</span>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="table-count">{{ productos().length }}</span>
          <button class="btn btn-outline" style="padding:6px 12px;font-size:12px" (click)="loadProducts()">
            ‚Ü∫ Recargar
          </button>
        </div>
      </div>

      <div *ngIf="pLoading()" class="empty-state">
        <div class="icon">‚è≥</div><p>Cargando‚Ä¶</p>
      </div>

      <div class="table-wrap" *ngIf="!pLoading()">
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Nombre</th>
              <th>SKU</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Cat.</th>
              <th>Activo</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of productos()">
              <td>
                <div class="thumb-wrap">
                  <img *ngIf="p.imageUrl" [src]="p.imageUrl" [alt]="p.nombre"
                       (error)="$any($event.target).style.display='none'" />
                  <span class="thumb-emoji" *ngIf="!p.imageUrl">{{ getCategoryIcon(p.categoria) }}</span>
                </div>
              </td>
              <td><strong>{{ p.nombre }}</strong></td>
              <td style="color:#9ca3af;font-size:12px">{{ p.codigo }}</td>
              <td>${{ p.precio | number:'1.2-2' }}</td>
              <td [class.stock-low]="p.stock <= 5">{{ p.stock }}</td>
              <td>{{ getCategoryIcon(p.categoria) }} {{ p.categoria }}</td>
              <td>
                <span class="badge" [class.badge-green]="p.activo" [class.badge-gray]="!p.activo">
                  {{ p.activo ? 'S√≠' : 'No' }}
                </span>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn edit" (click)="editProduct(p)" title="Editar">‚úèÔ∏è</button>
                  <button class="icon-btn delete" (click)="deleteProduct(p._id, p.nombre)" title="Eliminar">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="empty-state" *ngIf="productos().length === 0">
          <div class="icon">üóÇÔ∏è</div>
          <p>No hay productos a√∫n</p>
        </div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB USUARIOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" *ngIf="activeTab==='users'">

    <!-- Formulario usuario -->
    <div class="card">
      <p class="card-title">
        {{ uForm().id ? '‚úèÔ∏è Editar usuario' : '‚ûï Nuevo usuario' }}
      </p>

      <div class="product-form">

        <div class="form-row full">
          <div class="field">
            <label>Nombre *</label>
            <input type="text" placeholder="Ej. Mar√≠a L√≥pez"
              [ngModel]="uForm().name" (ngModelChange)="setUName($event)" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Email {{ uForm().id ? '(sin cambios)' : '*' }}</label>
            <input type="email" placeholder="correo@ejemplo.com"
              [disabled]="!!uForm().id"
              [ngModel]="uForm().email" (ngModelChange)="setUEmail($event)" />
          </div>
          <div class="field">
            <label>Contrase√±a {{ uForm().id ? '(opcional)' : '*' }}</label>
            <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              [ngModel]="uForm().password" (ngModelChange)="setUPass($event)" />
          </div>
        </div>

        <div class="form-row full">
          <div class="field">
            <label>Rol</label>
            <select [ngModel]="uForm().role" (ngModelChange)="setURole($event)">
              <option value="ADMIN">üîë Administrador</option>
              <option value="CASHIER">üë∑ Cajero</option>
            </select>
          </div>
        </div>

        <p class="error-msg" *ngIf="uError()">{{ uError() }}</p>

        <div class="form-actions">
          <button class="btn btn-outline" (click)="clearUserForm()">Limpiar</button>
          <button class="btn btn-primary" [disabled]="uLoading()" (click)="saveUser()">
            {{ uLoading() ? 'Guardando‚Ä¶' : uForm().id ? 'Actualizar' : 'Crear usuario' }}
          </button>
        </div>

      </div>
    </div>

    <!-- Tabla usuarios -->
    <div class="card table-card">
      <div class="table-header">
        <span class="table-title">Usuarios</span>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="table-count">{{ users().length }}</span>
          <button class="btn btn-outline" style="padding:6px 12px;font-size:12px" (click)="loadUsers()">
            ‚Ü∫ Recargar
          </button>
        </div>
      </div>

      <div *ngIf="uLoading()" class="empty-state">
        <div class="icon">‚è≥</div><p>Cargando‚Ä¶</p>
      </div>

      <div class="table-wrap" *ngIf="!uLoading()">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Email</th>
              <th>Rol</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of users()">
              <td><strong>{{ u.name }}</strong></td>
              <td style="color:#6b7280;font-size:12px">{{ u.email }}</td>
              <td>
                <span class="badge"
                  [class.badge-orange]="u.role==='ADMIN'"
                  [class.badge-blue]="u.role==='CASHIER'">
                  {{ u.role === 'ADMIN' ? 'üîë Admin' : 'üë∑ Cajero' }}
                </span>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn edit" (click)="editUser(u)" title="Editar">‚úèÔ∏è</button>
                  <button class="icon-btn delete" (click)="deleteUser(u.id, u.name)" title="Eliminar">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="empty-state" *ngIf="users().length === 0">
          <div class="icon">üë•</div>
          <p>No hay usuarios a√∫n</p>
        </div>
      </div>
    </div>

  </div>
</div>