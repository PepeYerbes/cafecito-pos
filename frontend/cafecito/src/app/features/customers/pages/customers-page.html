<!-- src/app/features/customers/pages/customers-page.html -->
<section class="customers">
  <h2>Clientes</h2>

  <div class="toolbar">
    <input
      type="search"
      placeholder="Buscar por nombre, teléfono o email"
      [ngModel]="q()"
      (ngModelChange)="q.set($event)"
      (keyup.enter)="search()"
    />
    <button (click)="search()">Buscar</button>
  </div>

  <div class="grid">
    <section class="card">
      <h3>{{ form()._id ? 'Editar cliente' : 'Nuevo cliente' }}</h3>
      <form (submit)="save(); $event.preventDefault()">

        <label>Nombre *
          <input [ngModel]="form().name || ''" (ngModelChange)="setFormName($event)"
                 name="name" placeholder="Ej. María López" />
        </label>

        <label>Teléfono
          <input [ngModel]="form().phone || ''" (ngModelChange)="setFormPhone($event)"
                 name="phone" placeholder="+521234567890" />
          <span class="field-hint">Incluye código de país: +52 para México</span>
        </label>

        <label>Email
          <input type="email" [ngModel]="form().email || ''" (ngModelChange)="setFormEmail($event)"
                 name="email" placeholder="correo@ejemplo.com" />
        </label>

        <label>Fecha de nacimiento
          <input type="date" [ngModel]="form().birthdate || ''" (ngModelChange)="setFormBirthdate($event)"
                 name="birthdate" />
        </label>

        <label>Notas
          <textarea rows="3" [ngModel]="form().notes || ''" (ngModelChange)="setFormNotes($event)"
                    name="notes" placeholder="Preferencias, alergias, etc."></textarea>
        </label>

        <div class="error-box" *ngIf="error()">⚠ {{ error() }}</div>

        <div class="actions">
          <button type="submit" class="btn-primary">{{ form()._id ? 'Actualizar' : 'Guardar' }}</button>
          <button type="button" class="outline" (click)="clear()">Limpiar</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h3>Listado</h3>
      <div *ngIf="loading()">Cargando…</div>

      <table class="table" *ngIf="!loading()">
        <thead>
          <tr>
            <th>Nombre</th><th>Contacto</th><th>Puntos</th><th>Visitas</th><th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of items()">
            <td>{{ c.name }}</td>
            <td>
              <div>{{ c.phone || '—' }}</div>
              <div>{{ c.email || '—' }}</div>
            </td>
            <td>{{ c.points || 0 }}</td>
            <td>{{ c.visitsCount || 0 }}</td>
            <td>
              <button (click)="edit(c)">Editar</button>
              <button class="danger" (click)="remove(c._id, c.name)">Eliminar</button>
              <div class="redeem">
                <input type="number" min="1" placeholder="Puntos"
                       [ngModel]="pointsToRedeem()" (ngModelChange)="pointsToRedeem.set($event)" />
                <button (click)="redeem(c)">Canjear</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <nav class="pager">
        <button (click)="go(page()-1)" [disabled]="page()===1">Anterior</button>
        <span>{{ page() }} / {{ pages() }}</span>
        <button (click)="go(page()+1)" [disabled]="page()===pages()">Siguiente</button>
      </nav>
    </section>
  </div>
</section>