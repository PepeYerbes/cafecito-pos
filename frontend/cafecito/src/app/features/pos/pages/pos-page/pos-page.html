<!-- pos/components/pages/pos-page/pos-page.html -->
<section class="layout" [class.handset]="isHandset">
  <!-- Sidebar rail (mini) + panel de expansiÃ³n -->
  <aside class="sidebar-rail" (mouseenter)="onSidebarEnter()" (mouseleave)="onSidebarLeave()">
    <!-- Rail (mini) siempre visible en desktop: sÃ³lo Ã­conos, sin fondo oscuro grande -->
    <div class="rail">
      <a routerLink="/pos" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="rail-item" title="Punto de venta">ğŸ§¾</a>
      <a routerLink="/pos/open-shift" routerLinkActive="active" class="rail-item" title="Abrir caja">ğŸ”“</a>
      <a routerLink="/pos/close-shift" routerLinkActive="active" class="rail-item" title="Cerrar caja">ğŸ”’</a>
      <a routerLink="/catalogo" routerLinkActive="active" class="rail-item" title="CatÃ¡logo">ğŸ—‚ï¸</a>
      <a routerLink="/config" routerLinkActive="active" class="rail-item" title="ConfiguraciÃ³n">âš™ï¸</a>
      <a routerLink="/pos/shift-history" routerLinkActive="active" class="rail-item" title="Historial cierres">ğŸ“œ</a>
      <a routerLink="/customers" routerLinkActive="active" class="rail-item" title="Clientes">ğŸ‘¥</a>
    </div>

    <!-- Panel expandido (overlay), aparece al hover -->
    <div class="panel" [class.visible]="panelVisible || isHandset">
      <div class="brand">
        <span class="logo">â˜•</span>
        <div class="title">
          <div class="name">POS</div>
          <small class="muted">Caja y Ventas</small>
        </div>
      </div>

      <nav class="nav">
        <a routerLink="/pos" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          ğŸ§¾ <span class="label">Punto de venta</span>
        </a>
        <a routerLink="/pos/open-shift" routerLinkActive="active">ğŸ”“ <span class="label">Abrir caja</span></a>
        <a routerLink="/pos/close-shift" routerLinkActive="active">ğŸ”’ <span class="label">Cerrar caja</span></a>
        <a routerLink="/catalogo" routerLinkActive="active">ğŸ—‚ï¸ <span class="label">CatÃ¡logo</span></a>
        <a routerLink="/config" routerLinkActive="active">âš™ï¸ <span class="label">ConfiguraciÃ³n</span></a>
        <a routerLink="/pos/shift-history" routerLinkActive="active">ğŸ“œ <span class="label">Historial cierres</span></a>
        <a routerLink="/customers" routerLinkActive="active">ğŸ‘¥ <span class="label">Clientes</span></a>
      </nav>

      <div class="session">
        <ng-container *ngIf="!loadingCash(); else loadingTpl">
          <div *ngIf="hasOpenSession(); else closedTpl" class="badge open">Caja abierta</div>
          <ng-template #closedTpl><div class="badge closed">Caja cerrada</div></ng-template>
        </ng-container>

        <div class="actions">
          <button class="btn" (click)="goOpenShift()">Abrir</button>
          <button class="btn outline" (click)="goCloseShift()">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- Fondo semitransparente sÃ³lo en mÃ³vil cuando el panel estÃ¡ visible -->
    <div class="backdrop" *ngIf="isHandset && panelVisible" (click)="closeSidebar()"></div>
  </aside>

  <!-- Contenido principal -->
  <main class="content">
    <header class="topbar">
      <!-- BotÃ³n hamburguesa visible SOLO en mÃ³vil -->
      <button class="menu-btn" type="button" (click)="toggleSidebar()" aria-label="Abrir menÃº" *ngIf="isHandset">
        â˜°
      </button>
      <h1>Punto de venta</h1>
      <span class="muted" *ngIf="cash(); else noCash">SesiÃ³n activa</span>
      <ng-template #noCash><span class="muted">Sin sesiÃ³n</span></ng-template>
    </header>

    <!-- Vista sin scroll: alto completo; panes en dos columnas -->
    <div class="workspace">
      <!-- Productos -->
      <section class="pane scrollable">
        <ng-container *ngIf="!loadingProducts(); else loadingTpl2">
          <app-product-grid [productos]="productos()" (add)="addProduct($event)"></app-product-grid>
        </ng-container>
        <ng-template #loadingTpl2><div class="muted">Cargando productosâ€¦</div></ng-template>
      </section>

      <!-- Carrito / Totales / Cliente -->
      <section class="pane narrow scrollable">
        <app-customer-picker (select)="setCustomer($event)"></app-customer-picker>
        <app-cart></app-cart>
        <app-totals (checkout)="onCheckout()" (sendToKitchen)="onSendToKitchen()"></app-totals>
      </section>
    </div>
  </main>
</section>

<ng-template #loadingTpl>
  <div class="muted">Verificando estado de cajaâ€¦</div>
</ng-template>