<!-- src/app/features/pos/components/product-grid/product-grid.html -->
<div class="grid">
  <button
    class="item"
    *ngFor="let p of productos"
    (click)="tryAdd(p)"
    [class.out-of-stock]="p.stock === 0"
    [title]="p.stock === 0 ? p.nombre + ' — Agotado' : p.nombre + ' — $' + p.precio">

    <!-- Imagen o placeholder -->
    <div class="product-img-wrap">
      <ng-container *ngIf="p.imageUrl; else iconPlaceholder">
        <img
          [src]="'http://localhost:3001' + p.imageUrl"
          [alt]="p.nombre"
          class="product-img"
          (error)="$any($event.target).style.display='none'; $any($event.target).nextElementSibling.style.display='flex'"
        />
        <div class="product-img-placeholder" style="display:none">
          {{ getCategoryIcon(p.categoria) }}
        </div>
      </ng-container>

      <ng-template #iconPlaceholder>
        <div class="product-img-placeholder">{{ getCategoryIcon(p.categoria) }}</div>
      </ng-template>

      <!-- Badge stock bajo -->
      <span class="stock-badge" *ngIf="p.stock <= 5 && p.stock > 0">
        {{ p.stock }} left
      </span>
      <!-- ✅ Badge agotado con overlay -->
      <span class="stock-badge out" *ngIf="p.stock === 0">Agotado</span>
    </div>

    <!-- ✅ Overlay gris para agotados -->
    <div class="sold-out-overlay" *ngIf="p.stock === 0">
      <span>Sin stock</span>
    </div>

    <div class="product-info">
      <div class="product-name">{{ p.nombre }}</div>
      <div class="product-footer">
        <span class="price">$ {{ p.precio | number:'1.0-2' }}</span>
        <span class="category-tag">{{ p.categoria }}</span>
      </div>
    </div>

  </button>
</div>